# 10주차

## 1

### 세션과 세션 하이재킹

**세션** : 컴퓨터와 컴퓨터간에 활성화된 논리적인 연결

**세션 하이재킹** : 세션을 가로채는 행위

**세션 하이재킹 공격자의 이점**

ID, 패스워드 입력, 확인 절차 Skip 가능



### TCP 세션 하이재킹 공격

시퀀스 정보의 문제점을 활용해 공격하는 방식

**RST**(세션 리셋 패킷)을 이용해 **일시적**으로 **TCP 세션을 끊은**다음 

**공격자**가 새로운 시퀀스 넘버를 서버쪽으로 보내서 **클라이언트의 리셋으로 위장**

공격자가 세션을 빼앗고 **인증**



**TCP 세션의 두가지 상태**

- **동기화 상태**

  정상적인 접속 상태

- **비동기화 상태**

  일시적으로 접속이 끊어진 상태

동기화 상태 > 비동기화 상태 > 하이재킹

**비동기화를 만드는 방법**

- 서버에서 초기설정 단계의 접속을 끊고, 다른 시퀀스 넘버로 새로운 접속을 생성
- 대용량의 null 데이터를 보내 서버를 비동기화 상태로 만듦



### 3-Way-HandShaking

TCP 연결에서의 시퀀스 넘버 정의

| 명칭              | 설명                                      |
| ----------------- | ----------------------------------------- |
| Client_My_Seq     | 클라이언트가 관리하는 자신의 시퀀스 넘버  |
| Client_Server_Seq | 클라이언트가 알고 있는 서버의 시퀀스 넘버 |
| Server_My_Seq     | 서버가 관리하는 자신의 시퀀스 넘버        |
| Server_Client_Seq | 서버가 알고있는 클라이언트의 시퀀스 넘버  |
| Data_Len          | 데이터의 길이                             |

**TCP 세션 하이재킹 공격 순서**

1. 클라이언트는 서버와 모두 접속되어 있는 Established 상태
2. 세션이 완전히 끊어지지 않는 범위에서 RST패킷을 생성해 서버에 전송. 서버는 잠시 Closed 상태
3. 공격자는 그상태에서 A_Client_My_Seq를 생성하여 서버에 전송
4. 서버는 SYN 수신 후 ACK를 재 생성하여 공격자에게 보낸 후 SYN_Received 상태
5. 공격자는 정상 연결처럼 서버와 시퀀스 넘버를 교환. 공격자와 서버 모두 Established 상태



### TCP 세션 하이재킹 NEWS

**화이트 해커 '차오 유에' 사례**

원격으로 TCP 세션 하이재킹 성공

사용자의 IP 주소로 원격에서 통신을 자신의 뜻대로 하이재킹

안드로이드와 리눅스 등 대부분 시스템의 세션 하이재킹 노출을 보여주는 사례



### 세션 하이재킹 대응 방안

- 데이터 전송의 암호화
- 비동기화 상태 탐지
- ACK Storm 탐지
- 패킷의 유실과 재전송 증가 탐지
- 기대하지 않은 접속의 리셋



## 2

### ARP 스푸핑의 배경지식

**스푸핑(spoofing)** : 속이다 라는 의미로, IP주소, 호스트, MAC주소를 속여 다양한 정보를 얻어내는 공격

**ARP** : IP주소값으로 MAC 주소 값을 알아내는 프로토콜

**RARP** : MAC주소 값으로 IP 주소 값을 알아내는 프로토콜



### ARP 스푸핑 공격이란?

MAC 주소를 속이는 것

MAC 주소를 공격자의 주소로 속임

**공격자**가 클라이언트와 서버 **중간에 위치**

**연결**을 유지하면서 내용을 계속 **확인**



### ARP 스푸핑 공격의 원리

A <- 공격자 -> B

A와 B에게 공격자가 마치 본인이 B와 A의 MAC주소인 듯 속인다.

공격 후에 패킷은 항상 공격자를 거치게 된다.



### ARP 스푸핑 공격 발생 증상

**피해 시스템에서의 주요 증상**

- 네트워크 속도 저하
- 악성코드 유포 공격코드 삽입
- 정기적인 ARP 패킷 다량 수신

**공격 시스템에서의 주요 증상**

- 네트워크 사용량 증가
- 정기적인 ARP 패킷 발송
- 악성 프로세스 동작



## 3

### 스푸핑이란?

'속이다, 사기치다' 라는 의미

임의 구성 웹사이트로 일반 사용자의 방문 유도

웹사이트에 접속한 개인정보 해킹



### IP 스푸핑이란?

자신의 IP주소를 공격/하고자 하는 타겟의 IP주소로 속이고 접근을 시도

서비스 거부 공격, 세션 종료

**IP 스푸핑의 공격 전제 조건**

**트러스트 관계** : ID와 PW를 사용하지 않고 로그인 없이 특정 클라이언트의 IP에 접속하는 것



### IP 스푸핑 공격 방법

1. 클라이언트와 서버의 트러스트 관계 형성
2. 공격자 > 클라이언트 DOS Attack
3. 공격자 > 서버 SYN 패킷 전송
4. 서버 > 클라이언트 SYN/ACK 패킷 전송
5. 공격자 > 서버 ACK Storm



**내부 네트워크에서 IP 스푸핑 공격**

1. 클라이언트와 서버의 트러스트 관계 형성
2. 공격자 > 서버 ARP cache posoning
3. 공격자 > 서버 SYN 패킷 전송
4. 서버 > 공격자 SYN/ACK 패킷 전송



### IP 스푸핑 예방 방법

1. Source Routing 허용 X

2. 시퀀스 번호 랜덤 발생

3. Dos 발생 사전 차단

4. 암호화된 프로토콜 사용

5. SSO기능 사용

   트러스트 관계에 치명적인 약점이 발견되면서 개발된 시스템

   **종류**

   - 윈도우 액티브 디렉터리
   - 썬 마이크로시스템즈 NIX+

   부득이한 트러스트 사용시 MAC주소를 고정형으로 지정한다.

   
